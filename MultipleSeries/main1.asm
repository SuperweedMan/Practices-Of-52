;多机通信，主机端
		T2CON EQU 0C8H
		TR2 EQU T2CON.2
		RCAP2L EQU 0CAH
		RCAP2H EQU 0CBH
		TH2 EQU 0CDH
		TL2 EQU 0CCH
		
		ORG 0000H
		LJMP MAIN
		ORG 0023H
		LJMP SERIES
MAIN:	MOV SP,#60H
		LCALL INIT
WRONG:	LCALL SENDADDRESS
		JNB F0,$
		CLR F0
		MOV A,32H
		CJNE A,#03H,WRONG
		LCALL SENDBUFF
		SJMP $

INIT:	PUSH PSW
		PUSH ACC
		MOV 32H,#4
		MOV 33H,#5
		MOV 34H,#6
		MOV TH2,#0FDH
		MOV TL2,#0F4H
		MOV RCAP2H,#0FDH
		MOV RCAP2L,#0F4H
		MOV T2CON,#30H
		MOV PCON,#80H
		MOV SCON,#0D0H
		SETB EA
		SETB ES
		SETB TR2
		POP ACC
		POP PSW
		RET

DELAY:	PUSH 30H
		PUSH 31H
		PUSH PSW
		PUSH ACC
		MOV 30H,#250
LOOP2:	MOV 31H,#250
LOOP1:	DJNZ 31H,LOOP1
		DJNZ 30H,LOOP2
		POP ACC
		POP PSW
		POP 31H
		POP 30H
		RET

SENDADDRESS:PUSH PSW
			PUSH ACC
			SETB TB8
			MOV SBUF,#03H
			JNB TI,$
			CLR TI
			POP ACC
			POP PSW
			RET
			
SENDBUFF:PUSH PSW
		PUSH ACC
		MOV 30H,#3
		MOV R0,#32H
SENDLOOP:MOV SBUF,@R0
		INC R0
		JNB TI,$
		CLR TI
		DJNZ 30H,SENDLOOP
		POP ACC
		POP PSW
		RET

SERIES:	JB RI,RECEIVE
		JB TI,SEND
		RETI
RECEIVE:PUSH ACC
		CLR RI
		SETB F0
		MOV A,SBUF
		MOV 32H,SBUF
		POP ACC
		RETI
SEND:	RETI
		END